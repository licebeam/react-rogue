(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{25:function(t,e,n){t.exports=n(42)},30:function(t,e,n){},42:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),a=n(12),o=n.n(a),c=(n(30),n(5)),l=n.n(c),u=n(6),s=n(4),d=n(13),m=n(14),f=n(15),h=n(21),p=n(16),g=n(22),y=n(2),v=n(1),w=n.n(v),k=n(17),x=n.n(k),E=60,b=E/2,R=b*E/2,O=n(3);function T(){var t=Object(y.a)(["\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-content: center;\n  justify-content: center;\n  text-align: center;\n  z-index: 0;\n  height: ",";\n  width: ",";\n  font-size: ",";\n  background-color: ",";\n  color: ",";\n  clip-path: ",";\n  .light {\n    position: absolute;\n    z-index: 10;\n    background-color: ",";\n    height: ",";\n    width: ",";\n    top: 0;\n    left: 0;\n  }\n  &:hover {\n    opacity: 0.8;\n  }\n  .sprite-image {\n    object-fit: cover;\n    height: ",";\n    width: ",";\n  }\n"]);return T=function(){return t},t}function j(){var t=Object(y.a)(["\n  align-self: center;\n  display: grid;\n  grid-template-columns: ",";\n  overflow: hidden;\n"]);return j=function(){return t},t}var M=O.a.div(j(),"repeat(".concat(b,", ").concat(12,"px)")),S=O.a.div(T(),"".concat(12,"px"),"".concat(12,"px"),"".concat(12*.8,"px"),function(t){switch(t.tile){case"wall":return"black";case"ground":return"green";case"dirt":return"burlywood";case"rock":return"grey";case"tree":return"darkgreen";case"player":case"rat":case"cat":return"black";case"apple":case"orange":case"stone":return"green"}},function(t){switch(t.tile){case"wall":return"grey";case"ground":return"darkgreen";case"dirt":return"brown";case"rock":return"darkgrey";case"tree":return"green";case"player":return"orange";case"rat":return"red";case"cat":return"brown";case"apple":return"red";case"orange":return"orange";case"stone":return"brown"}},function(t){switch(t.tile){case"player":return"clip-path: rect(50% 5%, 0% 100%, 100% 100%)"}},function(t){return"rgba(0, 0, 0, ".concat(t.lighting,")")},"".concat(12,"px"),"".concat(12,"px"),"".concat(12,"px"),"".concat(12,"px")),I={wall:{name:"wall",char:"X",img:null},ground:{name:"ground",char:"v",img:null},dirt:{name:"dirt",char:"^",img:null},tree:{name:"tree",char:"T",img:null},rock:{name:"rock",char:"M",img:null},portal:{name:"portal",char:"Z",img:null}},P=[{name:"apple",char:"9",img:null},{name:"orange",char:"0",img:null},{name:"stone",char:".",img:null},{name:"sword",char:"/",img:null}],A=n(20),C=function(t,e){var n=[],r=Object(A.NewDungeon)({width:E/2,height:E/2,minRoomSize:10,maxRoomSize:10}).map(function(t,e){return t.map(function(t,n){return function(t,e,n){var r=n>=1?n*E/2-1:n;switch(t){case 0:return{id:e+1+r,tile:I.ground,x:e,y:n};case 1:return{id:e+1+r,tile:I.wall,x:e,y:n};default:return{id:e+1+r,tile:I.ground,x:e,y:n}}}(t,n,e)})});n.push(r);var i=Object(s.a)(new Set(Object(v.flattenDeep)(n.filter(function(t){return t}))));return i=Object(v.flattenDeep)(i),i=D(i,"portal",e),i=L(i,"rock"),i=L(i,"tree"),i=L(i,"rock"),i=L(i,"tree"),i=L(i,"dirt"),i=L(i,"dirt"),i=N(i),i=N(i),i=N(i)},L=function(t,e){return t.map(function(t){var n=Math.floor(Math.random()*(R-1+1))+1;return"wall"!==t.tile.name&&(t.id===n+1||t.id===n-1||t.id===n)?{x:t.x,y:t.y,id:t.id,tile:I[e]}:t})},N=function(t){return t.map(function(t){var e=t.tile.name,n=Math.floor(Math.random()*P.length)+0,r=Math.floor(Math.random()*R)+1;return"wall"!==t.tile.name&&(t.id===r+1||t.id===r-1||t.id===r)?{x:t.x,y:t.y,id:t.id,tile:I[e],contains:P[n]}:t})},D=function t(e,n,r){var i=e,a=i.filter(function(t){return"ground"===t.tile.name}),o=a[Math.floor(Math.random()*a.length)],c=i.indexOf(o);return o.contains||o.id===r?t(e,n):(i[c].tile=I[n],i)},K=function(t,e,n,r,i){var a=r.find(function(e){return e.id===t.id+n}),o=e.find(function(t){return t.id===a.id&&t.roomId===i});return e.map(function(e){return!a||e.id!==t.id||function(t){switch(t){case"tree":case"wall":return!0}}(a.tile?a.tile.name:a.contains.name)||o||(e.id+=n),e})},z=[{type:"rat",char:"~o",img:null},{type:"cat",char:"~m",img:null}];function U(){var t=Object(y.a)(["\n  align-content: center;\n  justify-content: center;\n  text-align: center;\n  padding: 20px;\n  display: flex;\n  flex-direction: column;\n  font-size: 0.7rem;\n  flex: 1;\n  .location {\n    height: 80px;\n    word-wrap: break-word;\n    padding: 10px;\n  }\n  .controls {\n    button {\n      font-size: 0.4rem;\n      margin: 20px;\n      height: 20px;\n      width: 40px;\n      border: 2px solid black;\n    }\n  }\n"]);return U=function(){return t},t}function H(){var t=Object(y.a)(["\n  margin: 0 auto;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-content: center;\n"]);return H=function(){return t},t}var G=O.a.div(H()),J=O.a.div(U()),B=function(t){function e(){var t,n;Object(m.a)(this,e);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(n=Object(h.a)(this,(t=Object(p.a)(e)).call.apply(t,[this].concat(i)))).state={currentRoom:[],currentRoomId:0,allRooms:[],allEntities:[],loading:!1,currentTurn:0,playerTurn:!0,othersTurn:!1,currentTile:"",keyPress:!1,hoveredTile:{}},n.changeRooms=function(){n.state.currentRoomId<n.state.allRooms.length-1&&n.setState({currentRoomId:n.state.currentRoomId+1,loading:!0},function(){n.setState({currentRoom:n.state.allRooms[n.state.currentRoomId],loading:!1})})},n.generateRooms=function(t,e){var r=n.state.allEntities,i=[],a=[],o=0,c=i.length&&i[o].find(function(t){return"portal"===t.tile.name}).id||null,l=r.length&&r.find(function(t){return"player"===t.entity.type}).id||null;for(o=0;o<e;o++)i.push({roomId:o,room:C(t,c,l)});return n.setState({allRooms:i},function(){var t=0;for(t=0;t<e;t++)0===t&&a.push(n.addPlayerOnStart(n.state.allRooms[t].room)),a.push(n.entityGenerator(n.state.allRooms[t].room,t));n.setState({allEntities:Object(v.flatten)(a)})})},n.fireKey=function(t,e,r){var i=n.state,a=i.allEntities,o=i.currentRoom,c=i.currentRoomId,l=i.keyPress;r&&n.setState({keyPress:!0});var u=a.find(function(t){return"player"===t.entity.type});"ArrowUp"===e||"ArrowUp"===t.key&&!1===l?(n.setState({editEntities:K(u,a,-b,o.room,c)}),n.updateTurn()):"ArrowDown"===e||"ArrowDown"===t.key&&!1===l?(n.setState({editEntities:K(u,a,b,o.room,c)}),n.updateTurn()):"ArrowRight"===e||"ArrowRight"===t.key&&!1===l?(n.setState({editEntities:K(u,a,1,o.room,c)}),n.updateTurn()):("ArrowLeft"===e||"ArrowLeft"===t.key&&!1===l)&&(n.setState({editEntities:K(u,a,-1,o.room,c)}),n.updateTurn())},n.releaseKeys=function(){n.setState({keyPress:!1})},n.updateTurn=function(){var t=n.state,e=t.allEntities,r=t.currentRoom,i=e.find(function(t){return"player"===t.entity.type}),a=r.room.find(function(t){return t.id===i.id});n.setState({playerTurn:!n.state.playerTurn,currentTurn:n.state.currentTurn+1,currentTile:a})},n.entityGenerator=function(t,e){return t.map(function(t){var n=Math.floor(Math.random()*z.length)+0,r=Math.floor(Math.random()*E)+1;return"wall"!==t.tile.name&&t.id===r?{roomId:e,id:t.id,entity:z[n]}:null}).filter(function(t){return t})},n.addPlayerOnStart=function(t){var e=t.filter(function(t){return"wall"!==t.tile.name}),r=e[Math.floor(Math.random()*e.length)+1];if(!r.contains)return{roomId:n.state.currentRoomId,id:r.id,entity:{type:"player",char:"@",img:null}}},n.produceEntityOnScreen=function(t){var e=n.state,r=e.allEntities,i=e.currentRoomId,a=r.find(function(e){return e&&e.id&&e.id===t&&i===e.roomId&&"player"!==e.type?e.entity:e&&e.id&&e.id===t&&"player"===e.type?e.entity:void 0});if(a)return a},n.generateLighting=function(t){var e=n.state,r=e.allEntities,i=e.currentRoom,a=i&&i.room&&i.room.find(function(e){return e.id===t}),o=a.x,c=a.y,l=r&&r.find(function(t){return"player"===t.entity.type}),u=i&&i.room&&i.room.find(function(t){return t.id===l.id}),s=u.x,d=u.y;return l.id===t?0:n.checkRange(o,s-8,s+8)&&n.checkRange(c,d-8,d+8)?n.distance(u,a)/10:1},n.distance=function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},n.checkRange=function(t,e,n){return(t-e)*(t-n)<=0},n.findPath=function(t){var e=n.state,r=e.allEntities,i=e.currentRoom,a=r&&r.find(function(t){return"player"===t.entity.type}),o=i&&i.room&&i.room.find(function(t){return t.id===a.id}),c=o.x,l=o.y,u=i&&i.room&&i.room.map(function(t){return"ground"===t.tile.name?0:1}),s=w.a.chunk(u,b),d=new x.a.js;d.setGrid(s),d.setAcceptableTiles([0]),d.findPath(c,l,t.x,t.y,function(t){null===t?console.log("Path was not found."):(console.log("Path was found. The first Point is "+t[0].x+" "+t[0].y),n.mouseMovePlayer(t))}),d.calculate()},n.handleHover=function(t){n.setState({hoveredTile:t},function(){})},n.handleTileClick=function(t){n.findPath(t)},n.mouseMovePlayer=function(){var t=Object(d.a)(l.a.mark(function t(e){var r,i,a,o,c,d,m;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=n.state,i=r.currentRoom,a=r.allEntities,o=0;case 2:if(!(o<e.length)){t.next=10;break}return c=i&&i.room&&i.room.find(function(t){return t.x===e[o].x&&t.y===e[o].y}),d=a.find(function(t){return t.entity&&t.entity.type&&"player"===t.entity.type}),m=a.indexOf(d),t.next=8,n.setState({allEntities:Object.assign(Object(s.a)(a),Object(u.a)({},m,{roomId:n.state.currentRoomId,entity:d.entity,id:c.id}))},function(){o++,n.updateTurn()});case 8:t.next=2;break;case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),n}return Object(g.a)(e,t),Object(f.a)(e,[{key:"componentDidMount",value:function(){var t=this;this.setState({rooms:this.generateRooms(R,11)},function(){t.setState({currentRoom:t.state.allRooms[t.state.currentRoomId]})}),document.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(e){t.state.keyPress||t.fireKey(e,!1,!0)}),document.addEventListener("keyup",function(e){t.releaseKeys(e)})})}},{key:"componentDidUpdate",value:function(t,e){var n=this.state,r=n.allEntities,i=n.currentRoom;if((r.length&&r.find(function(t){return"player"===t.entity.type}).id)===(i&&i.room&&i.room.find(function(t){return"portal"===t.tile.name}).id)&&!1===this.state.loading&&this.changeRooms(),e.currentRoomId!==this.state.currentRoomId){var a=r.find(function(t){return"player"===t.entity.type}),o=r.indexOf(a);this.setState({allEntities:Object.assign(Object(s.a)(r),Object(u.a)({},o,{roomId:this.state.currentRoomId,id:a.id,entity:a.entity}))})}}},{key:"shouldComponentUpdate",value:function(t,e){return this.state.currentTurn!==e.currentTurn||(this.state.loading!==e.loading||(this.state.currentRoom!==e.currentRoom||this.state.allEntities!==e.allEntities))}},{key:"render",value:function(){var t=this,e=this.state,n=e.currentRoom,r=e.currentTurn,a=e.currentTile,o=e.playerTurn;return i.a.createElement(G,{className:"App"},i.a.createElement("button",{onClick:function(){return t.findPath()}},"Test paths"),i.a.createElement(M,{className:"tiles"},n&&n.room?n.room.map(function(e){if(t.produceEntityOnScreen(e.id)){var n=t.produceEntityOnScreen(e.id);return i.a.createElement(S,{onClick:function(){return t.handleTileClick(e)},onMouseOver:function(){return t.handleHover(e)},lighting:t.generateLighting(e.id),id:"player"===n.entity.type?"player":"entity",tile:n.entity.type,key:n.id+"ent"+Math.random()},n.entity.img?i.a.createElement("img",{className:"sprite-image",src:n.entity.img,alt:""}):n.entity.char,i.a.createElement("div",{className:"light"}))}return e.contains?i.a.createElement(S,{onClick:function(){return t.handleTileClick(e)},onMouseOver:function(){return t.handleHover(e)},lighting:t.generateLighting(e.id),tile:e.contains.name,key:e.id+"tile"+Math.random()},e.contains.img?i.a.createElement("img",{className:"sprite-image",src:e.contains.img,alt:""}):e.contains.char,i.a.createElement("div",{className:"light"})):i.a.createElement(S,{onClick:function(){return t.handleTileClick(e)},onMouseOver:function(){return t.handleHover(e)},lighting:t.generateLighting(e.id),tile:e.tile.name,key:e.id+"normal"+Math.random()},e.tile.img?i.a.createElement("img",{className:"sprite-image",src:e.tile.img,alt:""}):e.tile.char,i.a.createElement("div",{className:"light"}))}):null),i.a.createElement(J,null,i.a.createElement("div",{className:"location"},i.a.createElement("div",null,r),i.a.createElement("div",null,"player: ",o.toString()),i.a.createElement("div",null,"currentTile:",JSON.stringify(a))),i.a.createElement("div",{className:"controls"},i.a.createElement("button",{onClick:function(){return t.fireKey(!1,"ArrowUp",!1)}},"up"),i.a.createElement("button",{onClick:function(){return t.fireKey(!1,"ArrowDown",!1)}},"Down"),i.a.createElement("button",{onClick:function(){return t.fireKey(!1,"ArrowLeft",!1)}},"Left"),i.a.createElement("button",{onClick:function(){return t.fireKey(!1,"ArrowRight",!1)}},"Right"))))}}]),e}(r.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(B,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[25,1,2]]]);
//# sourceMappingURL=main.c0e65198.chunk.js.map